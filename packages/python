#!/bin/bash

source "$(dirname "$0")"/../common/common_source

NAME=Python
VERSION=$PYTHON_VER
TARFILE=$NAME-$VERSION.tar.xz
FETCH_URL="https://www.python.org/ftp/python/$VERSION/$TARFILE"
FETCH_PYTHON_DOCS="https://docs.python.org/ftp/python/doc/$VERSION/python-$VERSION-docs-html.tar.bz2"
mSBU=4400

provide_source_urls()
{
    echo $FETCH_URL $FETCH_PYTHON_DOCS
    return 0
}

fetch()
{
    warn_if_missing $FETCH_URL $TARFILE
    warn_if_missing $FETCH_PYTHON_DOCS $(basename $FETCH_PYTHON_DOCS)
}

configure()
{
    cd "$WORKBENCH/$NAME-$VERSION"
    BUILD_PATH=$(pwd)

    ./configure \
        --prefix=/usr \
        --enable-shared \
        --with-system-expat \
        --with-system-ffi \
        --with-ensurepip=yes \
        --enable-optimizations >>"$LOGFILE" 2>&1
}

post_install()
{
    cd "$BUILD_PATH"
    {
        install -v -dm755 /usr/share/doc/python-$VERSION/html

        local docfile=$(basename $FETCH_PYTHON_DOCS)
        cp -vf "$SRCDIR/$docfile" "$WORKBENCH/$docfile"

        tar \
            --strip-components=1  \
            --no-same-owner \
            --no-same-permissions \
            -C /usr/share/doc/python-$VERSION/html \
            -xvf "$WORKBENCH"/python-$VERSION-docs-html.tar.bz2
        rm "$WORKBENCH/$docfile"

    } >>"$LOGFILE" 2>&1
}

source "$(dirname "$0")"/../common/common_exec

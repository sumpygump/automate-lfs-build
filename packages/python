#!/bin/bash

source "$(dirname "$0")"/../common/common_source

NAME=Python
VERSION=$PYTHON_VER
TARFILE=$NAME-$VERSION.tar.xz
FETCH_URL="https://www.python.org/ftp/python/3.7.2/$TARFILE"
FETCH_PYTHON_DOCS="https://docs.python.org/ftp/python/doc/3.7.2/python-3.7.2-docs-html.tar.bz2"
mSBU=1000

provide_source_urls()
{
    echo $FETCH_URL $FETCH_PYTHON_DOCS
    return 0
}

fetch()
{
    warn_if_missing $FETCH_URL $TARFILE
    warn_if_missing $FETCH_PYTHON_DOCS $(basename $FETCH_PYTHON_DOCS)
}

configure()
{
    cd "$TMP"/"$NAME"-"$VERSION"
    mkdir build; cd build; BUILD_PATH=$(pwd)

    ../configure --prefix=/usr --enable-shared --with-system-expat --with-system-ffi --with-ensurepip=yes >>"$LOGFILE" 2>&1
}

post_install()
{
    cd "$BUILD_PATH"
    {
        local docfile=$(basename $FETCH_PYTHON_DOCS)
        cp -vf "$SRCDIR/$docfile" "$TMP/$docfile"
        chmod -v 755 /usr/lib/libpython3.7m.so
        chmod -v 755 /usr/lib/libpython3.so
        install -v -dm755 /usr/share/doc/python-3.7.2/html

        tar \
            --strip-components=1  \
            --no-same-owner \
            --no-same-permissions \
            -C /usr/share/doc/python-3.7.2/html \
            -xvf "$TMP"/python-3.7.2-docs-html.tar.bz2
        rm "$TMP/$docfile"

    } >>"$LOGFILE" 2>&1
}

source "$(dirname "$0")"/../common/common_exec

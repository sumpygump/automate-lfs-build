#!/bin/bash

source "$(dirname "$0")"/../common/common_source

NAME=vim
VERSION=$VIM_VER
TARFILE=$NAME-$VERSION.tar.bz2
FETCH_URL="ftp://ftp.vim.org/pub/vim/unix/$TARFILE"
mSBU=1300

extract()
{
    [ -d "$WORKBENCH/vim81" ] && rm -rf "$WORKBENCH/vim81"
    default_extract "$SRCDIR/$TARFILE"
}

configure()
{
    cd "$WORKBENCH/vim81"
    BUILD_PATH=$(pwd)
    ./configure --prefix=/usr >>"$LOGFILE" 2>&1
}

post_install()
{
    {
        ln -sv vim /usr/bin/vi
        for L in  /usr/share/man/{,*/}man1/vim.1; do     ln -sv vim.1 $(dirname $L)/vi.1; done
        ln -sv ../vim/vim81/doc /usr/share/doc/vim-8.1
    } >>"$LOGFILE" 2>&1
    cat > /etc/vimrc << "EOF"
" Begin /etc/vimrc
" Ensure defaults are set before customizing settings, not after
source $VIMRUNTIME/defaults.vim
let skip_defaults_vim=1
set nocompatible
set backspace=2
set mouse=
syntax on
if (&term == "xterm") || (&term == "putty")
  set background=dark
endif
" End /etc/vimrc
EOF
}

cleanup()
{
    default_cleanup "$WORKBENCH/vim81"
}

source "$(dirname "$0")"/../common/common_exec

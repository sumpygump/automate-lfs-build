#!/bin/bash

source "$(dirname "$0")"/../common/common_source

NAME=vim
VERSION=$VIM_VER
TARFILE=$NAME-$VERSION.tar.gz
FETCH_URL="https://anduin.linuxfromscratch.org/LFS/$TARFILE"
mSBU=600

configure()
{
    cd "$WORKBENCH/$NAME-$VERSION"
    BUILD_PATH=$(pwd)

    echo '#define SYS_VIMRC_FILE "/etc/vimrc"' >> src/feature.h

    ./configure --prefix=/usr >>"$LOGFILE" 2>&1
}

post_install()
{
    {
    # Symlink vi for vim
    ln -svf vim /usr/bin/vi
    for L in  /usr/share/man/{,*/}man1/vim.1; do
        ln -svf vim.1 $(dirname $L)/vi.1
    done

    # Make location of documentation consistent
    ln -svf ../vim/vim82/doc /usr/share/doc/vim-$VERSION
    } >>"$LOGFILE" 2>&1

    cat > /etc/vimrc << "EOF"
" Begin /etc/vimrc
" Ensure defaults are set before customizing settings, not after
source $VIMRUNTIME/defaults.vim
let skip_defaults_vim=1
set nocompatible
set backspace=2
set mouse=
syntax on
if (&term == "xterm") || (&term == "putty")
  set background=dark
endif
" End /etc/vimrc
EOF
}

source "$(dirname "$0")"/../common/common_exec

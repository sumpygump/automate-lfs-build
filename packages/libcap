#!/bin/bash

source "$(dirname "$0")"/../common/common_source

NAME=libcap
VERSION=$LIBCAP_VER
TARFILE=$NAME-$VERSION.tar.xz
FETCH_URL="https://www.kernel.org/pub/linux/libs/security/linux-privs/libcap2/$TARFILE"
mSBU=50

patchup()
{
    cd "$WORKBENCH/$NAME-$VERSION"
    sed -i '/install.*STALIBNAME/d' libcap/Makefile
}

configure()
{
    cd "$WORKBENCH/$NAME-$VERSION"
    BUILD_PATH=$(pwd)
}

build_install()
{
    cd $BUILD_PATH
    make $SILENT_MAKE $MAKE_JOBS RAISE_SETFCAP=no lib=lib prefix=/usr install >>"$LOGFILE" 2>&1
}

post_install()
{
    {
    chmod -v 755 /usr/lib/libcap.so.2.26
    mv -v /usr/lib/libcap.so.* /lib
    ln -sfv ../../lib/$(readlink /usr/lib/libcap.so) /usr/lib/libcap.so
    } >>"$LOGFILE" 2>&1
}

source "$(dirname "$0")"/../common/common_exec

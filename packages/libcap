#!/bin/bash

source "$(dirname "$0")"/../common/common_source

NAME=libcap
VERSION=$LIBCAP_VER
TARFILE=$NAME-$VERSION.tar.xz
FETCH_URL="https://www.kernel.org/pub/linux/libs/security/linux-privs/libcap2/$TARFILE"
mSBU=50

patchup()
{
    cd "$WORKBENCH/$NAME-$VERSION"
    sed -i '/install -m.*STA/d' libcap/Makefile
}

configure()
{
    cd "$WORKBENCH/$NAME-$VERSION"
    BUILD_PATH=$(pwd)
}

build()
{
    cd $BUILD_PATH
    make $MAKE_JOBS prefix=/usr lib=lib >>"$LOGFILE" 2>&1

    make test >> "$LOGFILE" 2>&1
}

build_install()
{
    cd $BUILD_PATH
    make $SILENT_MAKE $MAKE_JOBS prefix=/usr lib=lib install >>"$LOGFILE" 2>&1
}

post_install()
{
    {
    chmod -v 755 /usr/lib/lib{cap,psx}.so.$VERSION
    } >>"$LOGFILE" 2>&1
}

source "$(dirname "$0")"/../common/common_exec
